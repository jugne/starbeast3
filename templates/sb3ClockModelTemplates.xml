
<beast version='2.0'
       namespace='beast.app.beauti:beast.core:beast.evolution.branchratemodel:beast.evolution.speciation:beast.evolution.tree.coalescent:beast.core.util:beast.evolution.nuc:beast.evolution.operators:beast.evolution.sitemodel:beast.evolution.substitutionmodel:beast.evolution.likelihood:beast.evolution:beast.math.distributions'>


    <!-- Clock models -->
    <mergewith point='sb3ClockModelTemplates'>





		
        <!-- Strict clock -->
        <subtemplate id='SpeciesTreeStrictClock' class='starbeast3.evolution.branchratemodel.StrictClockModelSB3' mainid='strictClockModel.$(n)'>
            <![CDATA[
			

				<plugin id="strictClockModel.$(n)" tree="@Tree.t:$(n)" spec="starbeast3.evolution.branchratemodel.StrictClockModelSB3">
					 <clock.rate id='SpeciesTreeStrictClockRate' spec='parameter.RealParameter' lower="0.0" value='1.0' estimate='false'/>
				</plugin>

				<operator id="strictClockRateScaler.c:$(n)" rootOnly="true" scaleFactor="0.7" spec="BactrianScaleOperator" parameter="@SpeciesTreeStrictClockRate" weight="3.0"/>
				<prior id="SB3StrictClockPrior" name="distribution" x="@SpeciesTreeStrictClockRate">
					<OneOnX id="SB3StrictClockPrior.OneOnX" name="distr"/>
				</prior>
				
			]]>

			<!--
			<connect srcID="strictClockModel.$(n)" targetID="branchRatesModel.$(n)" inputName="branchRateModel"/>
			-->

			<!-- Estimate clock rate? -->
			<connect srcID="SpeciesTreeStrictClockRate" targetID="state" inputName="stateNode" if="inlikelihood(SpeciesTreeStrictClockRate) and SpeciesTreeStrictClockRate/estimate=true"/> 
			<connect srcID="SB3StrictClockPrior" targetID="prior" inputName="distribution" if="inlikelihood(SpeciesTreeStrictClockRate) and SpeciesTreeStrictClockRate/estimate=true"/> 
			<connect srcID="strictClockRateScaler.c:$(n)" targetID="mcmc" inputName="operator" if="inlikelihood(SpeciesTreeStrictClockRate) and SpeciesTreeStrictClockRate/estimate=true"/> 
			<connect srcID="SpeciesTreeStrictClockRate" targetID="updown.all" inputName="up" if="inlikelihood(SpeciesTreeStrictClockRate) and SpeciesTreeStrictClockRate/estimate=true"/>
			<connect srcID="SpeciesTreeStrictClockRate" targetID="tracelog" inputName="log" if="inlikelihood(SpeciesTreeStrictClockRate) and SpeciesTreeStrictClockRate/estimate=true"/>

			
        </subtemplate>
		
		
		
		
		
		
		 <!-- Relaxed clock -->
        <subtemplate id='SpeciesTreeRelaxedClock' class='starbeast3.evolution.branchratemodel.UCRelaxedClockModelSB3' mainid='relaxedClockModel.$(n)'>
         
            <![CDATA[

				<plugin id="relaxedClockModel.$(n)" tree="@Tree.t:$(n)" spec="starbeast3.evolution.branchratemodel.UCRelaxedClockModelSB3" estimateRoot="true" >
					<clock.rate id='SpeciesTreeRelaxedClockRate' spec='parameter.RealParameter' lower="0.0" value='1.0' estimate='false'/>
					<realRates id="SpeciesTreeRelaxedClockBranchRates" spec='parameter.RealParameter' estimate="true" lower="0.0">1</realRates>
					<stdev id="SpeciesTreeRelaxedClockSD" lower="0.0" upper="1.0" estimate="true" spec="parameter.RealParameter">0.1</stdev>		
				</plugin>

				<operator id="relaxedClockRateScaler.c:$(n)" rootOnly="true" scaleFactor="0.7" spec="BactrianScaleOperator" parameter="@SpeciesTreeRelaxedClockRate" weight="3.0"/>
				<prior id="SB3RelaxedClockPrior" name="distribution" x="@SpeciesTreeRelaxedClockRate">
					<OneOnX id="SB3RelaxedClockPrior.OneOnX" name="distr"/>
				</prior>
				
				<prior id="ucldStdevPrior.clock" name="distribution" x="@SpeciesTreeRelaxedClockSD">
					<Gamma id="Gamma.stddev" name="distr" alpha="5" beta="0.05" />
				</prior>
										
				<prior id="FastRatePriorDistributionClock" name="distribution" x="@SpeciesTreeRelaxedClockBranchRates">
					<LogNormal M="1.0" S="@SpeciesTreeRelaxedClockSD" id="LogNormalDistributionModel.rates" meanInRealSpace="true" name="distr"/>
				</prior>
				
				
				<operator id="AdaptableOperatorSampler.ucldStdev:$(n)" spec="orc.operators.AdaptableOperatorSampler" weight="5.0" parameter="@SpeciesTreeRelaxedClockSD">
					<operator id="UcldStdevScale.clock" parameter="@SpeciesTreeRelaxedClockSD" scaleFactor="0.5" spec="BactrianScaleOperator" weight="1"/>
					<operator id="SampleFromPriorOperator.c:ucldStdev" parameter="@SpeciesTreeRelaxedClockSD" prior2="@ucldStdevPrior.clock" spec="orc.operators.SampleFromPriorOperator" weight="1"/>
				</operator>
				
				
				<operator id="AdaptableOperatorSampler.rates:$(n)" parameter="@SpeciesTreeRelaxedClockBranchRates" spec="orc.operators.AdaptableOperatorSampler" weight="20">
					<operator id="Scale.branchRates" parameter="@SpeciesTreeRelaxedClockBranchRates" scaleFactor="0.75" spec="BactrianScaleOperator" weight="1.0"/>
					<operator clock="@relaxedClockModel.$(n)" id="ConstantDistanceOperatorSpeciesTree" popsizes="@popSize" proportionalToBranchLength="true" spec="starbeast3.operators.ConstantDistanceOperatorSpeciesTree" tree="@Tree.t:$(n)" twindowSize="0.1" weight="1.0" />
					<operator id="SampleFromPriorOperator.branchRates" np="1" parameter="@SpeciesTreeRelaxedClockBranchRates" prior2="@FastRatePriorDistributionClock" spec="orc.operators.SampleFromPriorOperator" weight="1"/>
				</operator>
				
				
				<log branchratemodel="@relaxedClockModel.$(n)" id="RateStatLogger" spec="beast.evolution.branchratemodel.RateStatistic" tree="@Tree.t:$(n)"/>

				
			]]>


			<!--
			<connect srcID="relaxedClockModel.$(n)" targetID="branchRatesModel.$(n)" inputName="branchRateModel"/>
			-->

			<!-- Estimate clock rate? -->
			<connect srcID="SpeciesTreeRelaxedClockRate" targetID="state" inputName="stateNode" if="inlikelihood(SpeciesTreeRelaxedClockRate) and SpeciesTreeRelaxedClockRate/estimate=true"/>
			<connect srcID="SpeciesTreeRelaxedClockRate" targetID="tracelog" inputName="log" if="inlikelihood(SpeciesTreeRelaxedClockRate) and SpeciesTreeRelaxedClockRate/estimate=true"/>			
			<connect srcID="SB3RelaxedClockPrior" targetID="prior" inputName="distribution" if="inlikelihood(SpeciesTreeRelaxedClockRate) and SpeciesTreeRelaxedClockRate/estimate=true"/> 
			<connect srcID="relaxedClockRateScaler.c:$(n)" targetID="mcmc" inputName="operator" if="inlikelihood(SpeciesTreeRelaxedClockRate) and SpeciesTreeRelaxedClockRate/estimate=true"/> 
			<connect srcID="SpeciesTreeRelaxedClockRate" targetID="updown.all" inputName="up" if="inlikelihood(SpeciesTreeRelaxedClockRate) and SpeciesTreeRelaxedClockRate/estimate=true"/>
			
			
			
			<!-- Estimate branch rates? -->
			<connect srcID="SpeciesTreeRelaxedClockBranchRates" targetID="state" inputName="stateNode" if="inlikelihood(SpeciesTreeRelaxedClockBranchRates) and SpeciesTreeRelaxedClockBranchRates/estimate=true"/> 
			<connect srcID="RateStatLogger" targetID="tracelog" inputName="log" if="inlikelihood(SpeciesTreeRelaxedClockBranchRates) and SpeciesTreeRelaxedClockBranchRates/estimate=true"/>
			<connect srcID="FastRatePriorDistributionClock" targetID="prior" inputName="distribution" if="inlikelihood(SpeciesTreeRelaxedClockBranchRates) and SpeciesTreeRelaxedClockBranchRates/estimate=true"/> 
			<connect srcID="AdaptableOperatorSampler.rates:$(n)" targetID="mcmc" inputName="operator" if="inlikelihood(SpeciesTreeRelaxedClockBranchRates) and SpeciesTreeRelaxedClockBranchRates/estimate=true"/> 
			<connect srcID="ConstantDistanceOperatorSpeciesTree" targetID="AdaptableTopologyOperator.lengths.$(n)" inputName="operator" if="inlikelihood(SpeciesTreeRelaxedClockBranchRates) and SpeciesTreeRelaxedClockBranchRates/estimate=true"/> 
			<connect srcID="SpeciesTreeRelaxedClockBranchRates" targetID="SpeciesTreeLoggerX" inputName="metadata" if="inlikelihood(SpeciesTreeRelaxedClockBranchRates) and SpeciesTreeRelaxedClockBranchRates/estimate=true"/> 
			
			<connect srcID="treePrior.t:$(n)" targetID="ConstantDistanceOperatorSpeciesTree" inputName="gene" if="inlikelihood(Tree.t:$(n)) and Tree.t:$(n)/estimate=true"/>
			
			
			
			<!-- Estimate stddev?  -->
			<connect srcID="SpeciesTreeRelaxedClockSD" targetID="state" inputName="stateNode" if="inlikelihood(SpeciesTreeRelaxedClockSD) and SpeciesTreeRelaxedClockSD/estimate=true"/> 
			<connect srcID="SpeciesTreeRelaxedClockSD" targetID="tracelog" inputName="log" if="inlikelihood(SpeciesTreeRelaxedClockSD) and SpeciesTreeRelaxedClockSD/estimate=true"/>
			<connect srcID="ucldStdevPrior.clock" targetID="prior" inputName="distribution" if="inlikelihood(SpeciesTreeRelaxedClockSD) and SpeciesTreeRelaxedClockSD/estimate=true"/> 
			<connect srcID="AdaptableOperatorSampler.ucldStdev:$(n)" targetID="mcmc" inputName="operator" if="inlikelihood(SpeciesTreeRelaxedClockSD) and SpeciesTreeRelaxedClockSD/estimate=true"/> 
			

			
			
			
        </subtemplate>

		

		
		
		

    </mergewith>

</beast>


